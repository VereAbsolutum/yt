<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <header class="header " >
        <nav class="navbar bg-body-tertiary ">
            <div class="container-fluid ">
                <div class="border border-sm w-100">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="my-4 h4 text-center">
                                Manwha
                            </h2>
                        </div>
                    </div>
                </div>
            </div>
          </nav>
    </header>
    <main>
        <section class="mb-4">
            <div class="container-fluid">
                <div class="card">
                    <div class="card-header">
                        <h1 class="text-center">Importar</h1>
                    </div>
                    <div class="card-body">
                        <div class="card border-0">
                            <div class="card-body">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <header class="pt-4 px-3">
                                                <h2 class="">Imagens</h2>
                                            </header>
                                            <hr>
                                        </div>
                                        <div class="col-md-6">
                                            <header class="pt-4 px-3">
                                                <h2 class="">Texts</h2>
                                            </header>
                                            <hr>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="container-fluid">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="mb-3">
                                                            <label for="formFileMultiple" class="form-label">Escolha as imagens.</label>
                                                            <input id="image-input" class="form-control" type="file" id="formFileMultiple" multiple>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="btn-group d-flex" role="group" aria-label="Basic example">
                                                            <button id="list-images" type="button" class="btn btn-warning btn-block py-4 rounded-0">Carregar Imagens</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="container-fluid">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="mb-3">
                                                            <label for="formFileMultiple" class="form-label">Escolha os textos.</label>
                                                            <input disabled id="text-input" class="form-control" type="file" id="formFileMultiple" multiple>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="btn-group d-flex" role="group" aria-label="Basic example">
                                                            <button id="list-text" type="button" class="btn btn-info btn-block py-4 rounded-0">Carregar Texto</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="mb-4">
            <div class="container-fluid">
                <div class="card">
                    <div class="card-header ">
                        <h2 class="text-center">
                            Imagens Grid
                        </h2>
                    </div>
                    <div class="card-body pt-4">
                        <h3 class="text-center mb-4">Escolhas as imagens abaixo</h3>
                        <hr>
                            <div class="container">
                                <div class="row">
                                    <div class="col-md-4"></div>
                                    <div class="col-md-4">
                                        <div class="btn-group d-flex" role="group" aria-label="Basic example">
                                            <button id="save-all-images" type="button" class="btn btn-primary btn-block py-4 rounded-0">Salvar Imagens</button>
                                            <span></span>
                                            <button id="save-all-texts" type="button" class="btn btn-success btn-block py-4 rounded-0">Salvar Textos</button>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                            </div>
                        <hr>
                        <div class="container-fluid mt-4">
                            <div class="row" id="sortableGrid">
                                <!-- -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="position-fixed bottom-0 end-0 " style="margin-right: 2rem; margin-bottom: 2rem;">
            <button id="total"  type="button" class="btn btn-primary">0</button>
        </div>
    </main>
    <!-- Inclua a biblioteca JSZip via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script src="./js/temporaryStorage.js"></script>
    <script src="./js/textProcessor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js" type = "text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/plugins/MultiDrag/MultiDrag.min.js"></script>
    <script src="./js/sortablejs.js"></script>
    <script src="./js/card.js"></script>
    <script src="./js/loadInput.js"></script>
    <script src="./js/loadCards.js"></script>
    <script src="./js/listImageData.js"></script>
    <script src="./js/listTextData.js"></script>
    <script src="./js/zip.js"></script>

    <script>
        function setStateTextInput(ev) {
            document.getElementById("text-input").disabled = false;
        }
    </script>

    <script>
        function handleText (ev) {
            var target = ev.target;

            if(target.hasAttribute('data-text')) {

                var newText = Array.from(document.querySelectorAll('[data-text]')).map(textarea => textarea.value.trim()).filter(text => text != '').join('.')
                textProcessor.splitNext(newText);
                textProcessor.splitPrevious(newText);

            }

        }
    </script>

    <script>


        function duplicateItem(item) {
            var newItem = item.cloneNode(true);
            //newItem.querySelector("button").remove(); // Remove the button from the cloned item
            item.parentNode.insertBefore(newItem, item.nextSibling);
        }

        function deleteItem(item) {
            item.parentNode.removeChild(item);
        }

        function handleCard(ev) {
            var target = ev.target;

            if (target.classList.contains('card-duplicate')) {
                var buttonDuplicate = target;
                var item = buttonDuplicate.closest('.sortable-item');
                duplicateItem(item);
            }

            if (target.classList.contains('card-delete')) {
                var buttonDuplicate = target;
                var item = buttonDuplicate.closest('.sortable-item');
                deleteItem(item);
            }

        }
    </script>

    <script>
        var grid = document.getElementById('sortableGrid');

        var observer = new MutationObserver(function(mutations) {

            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' || mutation.type === 'subtree') {
                    textProcessor.loadText(storage);
                }
            });

        });

        var observerConfig = { childList: true, subtree: true };
        observer.observe(grid, observerConfig);
    </script>

    <script>
        function saveAllImages(ev) {

            const data = storage.getImages();

            zip({
                data: [{
                    content:'content',
                    filename: 'filename'
                }],
                type: 'image'
            })

        }
        function saveAllTexts(ev) {

            const data = storage.getText();

            zip({
                data: [{
                    content:'content',
                    filename: 'filename'
                }],
                type: 'text'
            })

        }
    </script>

    <script>
        document.getElementById('list-images').addEventListener('click', listImageData);
        document.getElementById('list-text').addEventListener('click', listTextData);
        document.getElementById('image-input').addEventListener('change', setStateTextInput);
        document.getElementById('sortableGrid').addEventListener('change', handleText);
        document.getElementById('sortableGrid').addEventListener('click', handleCard);
        document.getElementById('save-all-images').addEventListener('click', saveAllImages);
        document.getElementById('save-all-texts').addEventListener('click', saveAllTexts);
        /*

        document.getElementById('sortableGrid').addEventListener('click', (ev) => {

            deleteCard(ev);
            duplicateCard(ev);
            selectCard(ev);


        })
        document.getElementById('sortableGrid').addEventListener('change', function(ev) {

            updateText(ev.target);

        })
        */
    </script>

    <script>

    </script>
</body>
</html>